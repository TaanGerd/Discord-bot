import discord
from discord.ext import commands, tasks
from datetime import datetime, timedelta
import asyncio # noqa: F401
import json
import os
from flask import Flask
from threading import Thread
import time

# ===========================================
# –ù–ê–°–¢–†–û–ô–ö–ê –ß–ê–°–û–í–û–ì–û –ü–û–Ø–°–ê (–ú–û–°–ö–û–í–°–ö–û–ï –í–†–ï–ú–Ø)
# ===========================================
import pytz  # –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pytz –µ—Å–ª–∏ –Ω–µ—Ç: pip install pytz
# pip install pytz

# –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –¥–ª—è –±–æ—Ç–∞
TIMEZONE = pytz.timezone('Europe/Moscow')

def get_now():
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø–æ –ú–æ—Å–∫–≤–µ"""
    return datetime.now(TIMEZONE)

def parse_datetime(year, month, day, hour, minute):
    """–°–æ–∑–¥–∞—Ç—å datetime –æ–±—ä–µ–∫—Ç –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–º –≤—Ä–µ–º–µ–Ω–∏"""
    naive_dt = datetime(year, month, day, hour, minute)
    return TIMEZONE.localize(naive_dt)

def from_iso_with_timezone(iso_string):
    """–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å ISO —Å—Ç—Ä–æ–∫—É –≤ datetime —Å —É—á–µ—Ç–æ–º –º–æ—Å–∫–æ–≤—Å–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏"""
    try:
        dt = datetime.fromisoformat(iso_string)
        # –ï—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —ç—Ç–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è
        if dt.tzinfo is None:
            return TIMEZONE.localize(dt)
        return dt.astimezone(TIMEZONE)
    except ValueError:
        # –î–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –±–µ–∑ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
        if 'Z' in iso_string:
            dt = datetime.fromisoformat(iso_string.replace('Z', '+00:00'))
        else:
            dt = datetime.fromisoformat(iso_string + '+00:00')
        return dt.astimezone(TIMEZONE)

TOKEN = ''

intents = discord.Intents.default()
intents.members = True
intents.message_content = True

bot = commands.Bot(command_prefix='!', intents=intents)

CONFIG_FILE = 'config.json'

class EventAnnouncement:
    def __init__(self, bot):
        self.bot = bot
        self.events = self.load_events()
        self.recurring_events = self.load_recurring_events()  # –ù–æ–≤—ã–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è
        self.config = self.load_config()
        self.check_events.start()
        self.cleanup_events.start()  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
        self.check_recurring_events.start()  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
    
    def load_config(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
        if os.path.exists(CONFIG_FILE):
            with open(CONFIG_FILE, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {
            'announcement_channel_id': None,
            'admin_channel_id': None,
            'allowed_roles': []  # –ù–æ–≤–æ–µ –ø–æ–ª–µ: —Å–ø–∏—Å–æ–∫ ID —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π
        }
    
    def save_config(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
        with open(CONFIG_FILE, 'w', encoding='utf-8') as f:
            json.dump(self.config, f, ensure_ascii=False, indent=2)
    
    def load_events(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏–∑ —Ñ–∞–π–ª–∞"""
        if os.path.exists('events.json'):
            with open('events.json', 'r', encoding='utf-8') as f:
                return json.load(f)
        return []
    
    def save_events(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—ã—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ —Ñ–∞–π–ª"""
        with open('events.json', 'w', encoding='utf-8') as f:
            json.dump(self.events, f, ensure_ascii=False, indent=2)
    
    def load_recurring_events(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π –∏–∑ —Ñ–∞–π–ª–∞"""
        if os.path.exists('recurring_events.json'):
            with open('recurring_events.json', 'r', encoding='utf-8') as f:
                return json.load(f)
        return []
    
    def save_recurring_events(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π –≤ —Ñ–∞–π–ª"""
        with open('recurring_events.json', 'w', encoding='utf-8') as f:
            json.dump(self.recurring_events, f, ensure_ascii=False, indent=2)
    
    def add_event(self, event_name, event_time, announcement_time, author_id, 
                  custom_message=None, image_url=None, attachments=None):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—ã—á–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è"""
        event = {
            'id': len(self.events) + 1,
            'name': event_name,
            'event_time': event_time.isoformat(),
            'announcement_time': announcement_time.isoformat(),
            'author': author_id,
            'custom_message': custom_message,
            'image_url': image_url,
            'attachments': attachments or [],
            'announced': False,
            'finished': False,
            'is_recurring': False  # –≠—Ç–æ –æ–±—ã—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
        }
        self.events.append(event)
        self.save_events()
        return event['id']
    
    def add_recurring_event(self, event_name, days_of_week, hour, minute, 
                           author_id, custom_message=None, image_url=None, attachments=None):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–±—ã—Ç–∏—è"""
        # –î–Ω–∏ –Ω–µ–¥–µ–ª–∏: —Å–ø–∏—Å–æ–∫ 0-–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 6-–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
        event = {
            'id': len(self.recurring_events) + 1,
            'name': event_name,
            'days_of_week': days_of_week,  # –°–ø–∏—Å–æ–∫ –¥–Ω–µ–π [0, 2, 4] –¥–ª—è –ø–Ω, —Å—Ä, –ø—Ç
            'hour': hour,
            'minute': minute,
            'author': author_id,
            'custom_message': custom_message,
            'image_url': image_url,
            'attachments': attachments or [],
            'is_recurring': True,
            'last_scheduled': {}
        }
        self.recurring_events.append(event)
        self.save_recurring_events()
        return event['id']
    
    def remove_event(self, event_id, is_recurring=False):
        """–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–æ–±—ã—á–Ω–æ–≥–æ –∏–ª–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ)"""
        if is_recurring:
            self.recurring_events = [e for e in self.recurring_events if e['id'] != event_id]
            self.save_recurring_events()
        else:
            self.events = [e for e in self.events if e['id'] != event_id]
            self.save_events()
    
    async def send_announcement(self, event, is_recurring=False):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª"""
        channel_id = self.config.get('announcement_channel_id')
        if not channel_id:
            print("–û—à–∏–±–∫–∞: –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π")
            return False
        
        channel = self.bot.get_channel(channel_id)
        if not channel:
            print(f"–û—à–∏–±–∫–∞: –∫–∞–Ω–∞–ª {channel_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return False
        
        # –°–æ–∑–¥–∞–µ–º embed –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        if is_recurring:
            title = f"üì¢ **{event['name']}** (–†–µ–≥—É–ª—è—Ä–Ω–æ–µ)"
        else:
            title = f"üì¢ **{event['name']}**"
        
        if is_recurring:
            event_time = get_now() + timedelta(minutes=15)
        else:
            event_time = from_iso_with_timezone(event['event_time'])
        
        embed = discord.Embed(
            title=title,
            description=event['custom_message'],
            color=discord.Color.gold(),
            timestamp=event_time
        )
        
        if is_recurring:
            # –î–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç
            embed.add_field(
                name="‚è∞ –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è", 
                value="–ß–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç",
                inline=False
            )
        else:
            embed.add_field(
                name="‚è∞ –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è", 
                value=f"<t:{int(event_time.timestamp())}:F>",
                inline=False
            )
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ
        if event.get('image_url'):
            embed.set_image(url=event['image_url'])
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–∏—è, –æ—Ç–º–µ—á–∞–µ–º –∏—Ö
        if event.get('attachments'):
            embed.set_footer(text=f"üìé {len(event['attachments'])} –≤–ª–æ–∂–µ–Ω–∏–π | ID: {event['id']}")
        else:
            embed.set_footer(text=f"ID: {event['id']}")
        
        try:
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º embed
            await channel.send(embed=embed)
            
            # –ï—Å–ª–∏ –µ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏—Ö –æ—Ç–¥–µ–ª—å–Ω–æ
            for attachment_url in event.get('attachments', []):
                await channel.send(f"üìé –í–ª–æ–∂–µ–Ω–∏–µ: {attachment_url}")
            
            if not is_recurring:
                event['announced'] = True
                self.save_events()
            
            return True
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e}")
            return False
    
    @tasks.loop(seconds=30)
    async def check_events(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π"""
        now = get_now()
        
        for event in self.events:
            if event['finished']:
                continue
            
            announcement_time = from_iso_with_timezone(event['announcement_time'])
            event_time = from_iso_with_timezone(event['event_time'])
            
            # –ï—Å–ª–∏ –≤—Ä–µ–º—è –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—É–ø–∏–ª–æ
            if not event['announced'] and announcement_time <= now:
                await self.send_announcement(event)
            
            # –ï—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ —É–∂–µ –ø—Ä–æ—à–ª–æ
            if event_time <= now:
                event['finished'] = True
                self.save_events()
    
    @tasks.loop(seconds=60)  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    async def check_recurring_events(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π"""
        now = get_now()
        current_day = now.weekday()  # 0-–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 6-–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
        current_hour = now.hour
        current_minute = now.minute
        
        for event in self.recurring_events:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å —Å –æ–¥–Ω–∏–º –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –¥–Ω–µ–π
            if current_day in event['days_of_week']:
                event_hour = event['hour']
                event_minute = event['minute']
                
                # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Ä–µ–º—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–∑–∞ 15 –º–∏–Ω—É—Ç –¥–æ —Å–æ–±—ã—Ç–∏—è)
                announcement_time = now.replace(hour=event_hour, minute=event_minute) - timedelta(minutes=15)
                
                # –ï—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤—Ä–µ–º–µ–Ω–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è
                if (current_hour == announcement_time.hour and 
                    current_minute == announcement_time.minute):
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –ª–∏ –º—ã —É–∂–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è
                    last_scheduled = event.get('last_scheduled', {})
                    today = now.date()
                    day_key = str(current_day)
                    
                    if last_scheduled.get(day_key) != str(today):
                        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
                        await self.send_announcement(event, is_recurring=True)
                        
                        # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è
                        last_scheduled[day_key] = str(today)
                        event['last_scheduled'] = last_scheduled
                        self.save_recurring_events()
    
    @tasks.loop(hours=6)  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
    async def cleanup_events(self):
        """–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π (—Å—Ç–∞—Ä—à–µ 3 –¥–Ω–µ–π)"""
        now = get_now()
        events_to_remove = []
        
        for event in self.events:
            if event['finished']:
                event_time = from_iso_with_timezone(event['event_time'])
                days_passed = (now - event_time).days
                
                # –£–¥–∞–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è, –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –±–æ–ª–µ–µ 3 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
                if days_passed > 3:
                    events_to_remove.append((event['id'], False))
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è
        for event_id, is_recurring in events_to_remove:
            self.remove_event(event_id, is_recurring)
        
        if events_to_remove:
            print(f"‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω–æ {len(events_to_remove)} —Å—Ç–∞—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π")
            await self.send_admin_log(f"üßπ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω–æ {len(events_to_remove)} —Å—Ç–∞—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π")
    
    async def send_admin_log(self, message):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω-–∫–∞–Ω–∞–ª"""
        channel_id = self.config.get('admin_channel_id')
        if not channel_id:
            return
        
        channel = self.bot.get_channel(channel_id)
        if channel:
            await channel.send(message)
    
    @check_events.before_loop
    async def before_check_events(self):
        await self.bot.wait_until_ready()
    
    @check_recurring_events.before_loop
    async def before_check_recurring_events(self):
        await self.bot.wait_until_ready()
    
    @cleanup_events.before_loop
    async def before_cleanup_events(self):
        await self.bot.wait_until_ready()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π
event_manager = None

@bot.event
async def on_ready():
    print(f'–ë–æ—Ç {bot.user} –∑–∞–ø—É—â–µ–Ω!')
    global event_manager
    event_manager = EventAnnouncement(bot)

# ===========================================
# –ü–†–û–í–ï–†–ö–ê –ü–†–ê–í –î–û–°–¢–£–ü–ê
# ===========================================

async def check_permissions(ctx):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ event_manager
    if not event_manager:
        return False
    
    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω-–∫–∞–Ω–∞–ª–∞
    admin_channel_id = event_manager.config.get('admin_channel_id')
    if not admin_channel_id or ctx.channel.id != admin_channel_id:
        return False
    
    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Discord
    if ctx.author.guild_permissions.administrator:
        return True
    
    # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π
    allowed_roles = event_manager.config.get('allowed_roles', [])
    
    # –ü–æ–ª—É—á–∞–µ–º ID –≤—Å–µ—Ö —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_role_ids = [role.id for role in ctx.author.roles]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–∞—è —Ä–æ–ª—å
    for role_id in allowed_roles:
        if role_id in user_role_ids:
            return True
    
    return False

# ===========================================
# –ö–û–ú–ê–ù–î–ê –ü–û–ú–û–©–ò
# ===========================================

@bot.command()
async def –ø–æ–º–æ—â—å(ctx):
    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    embed = discord.Embed(
        title="üìö **–°–ü–†–ê–í–ö–ê –ü–û –ö–û–ú–ê–ù–î–ê–ú**",
        description="–í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º –∞–¥–º–∏–Ω-–∫–∞–Ω–∞–ª–µ",
        color=discord.Color.blue()
    )
    
    # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è–º–∏
    embed.add_field(
        name="üéØ **–û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´**",
        value=(
            "`!–Ω–æ–≤–æ–µ –î–î –ú–ú –ì–ì–ì–ì –ß–ß –ú–ú —Ç–µ–∫—Å—Ç`\n"
            "–°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ\n"
            "*–ü—Ä–∏–º–µ—Ä: !–Ω–æ–≤–æ–µ 25 12 2024 20 0 –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –≤–µ—á–µ—Ä–∏–Ω–∫–∞*\n\n"
            
            "`!—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –¥–Ω–∏ –ß–ß –ú–ú —Ç–µ–∫—Å—Ç`\n"
            "–°–æ–∑–¥–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ\n"
            "*–ü—Ä–∏–º–µ—Ä: !—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –ø–Ω,—Å—Ä,–ø—Ç 19 00 –ò–≥—Ä–æ–≤–æ–π –≤–µ—á–µ—Ä*\n"
            "*–î–Ω–∏: –ø–Ω, –≤—Ç, —Å—Ä, —á—Ç, –ø—Ç, —Å–±, –≤—Å (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)*\n\n"
            
            "`!—Å–æ–±—ã—Ç–∏—è`\n"
            "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è (–∞–∫—Ç–∏–≤–Ω—ã–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ)\n\n"
            
            "`!—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ`\n"
            "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è\n\n"
            
            "`!–∏–Ω—Ñ–æ ID`\n"
            "–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–±—ã—Ç–∏–∏\n"
            "*–ü—Ä–∏–º–µ—Ä: !–∏–Ω—Ñ–æ 5*\n\n"
            
            "`!—É–¥–∞–ª–∏—Ç—å ID`\n"
            "–£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ\n"
            "*–ü—Ä–∏–º–µ—Ä: !—É–¥–∞–ª–∏—Ç—å 3*\n\n"
            
            "`!—É–¥–∞–ª–∏—Ç—å—Ä–µ–≥ ID`\n"
            "–£–¥–∞–ª–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ\n"
            "*–ü—Ä–∏–º–µ—Ä: !—É–¥–∞–ª–∏—Ç—å—Ä–µ–≥ 2*\n\n"
            
            "`!–æ—á–∏—Å—Ç–∫–∞`\n"
            "–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π (—Å—Ç–∞—Ä—à–µ 3 –¥–Ω–µ–π)"
        ),
        inline=False
    )
    
    # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–ª—è–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    embed.add_field(
        name="‚öôÔ∏è **–ö–û–ú–ê–ù–î–´ –î–õ–Ø –†–û–õ–ï–ô –ò –ù–ê–°–¢–†–û–ï–ö**",
        value=(
            "`!—Ä–æ–ª–∏`\n"
            "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏\n\n"
            
            "`!–∫–∞–Ω–∞–ª—ã`\n"
            "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n\n"
            
            "`!—Ç–µ—Å—Ç`\n"
            "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n\n"
            
            "`!–ø–æ–º–æ—â—å`\n"
            "–ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ"
        ),
        inline=False
    )
    
    # –ö–æ–º–∞–Ω–¥—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
    if ctx.author.guild_permissions.administrator:
        embed.add_field(
            name="üëë **–¢–û–õ–¨–ö–û –î–õ–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–û–í**",
            value=(
                "`!–∫–∞–Ω–∞–ª–∞–¥–º–∏–Ω`\n"
                "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–∞–Ω–∞–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n\n"
                
                "`!–∫–∞–Ω–∞–ª–æ–±—ä—è–≤–ª–µ–Ω–∏–π`\n"
                "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π\n\n"
                
                "`!–¥–æ–±–∞–≤–∏—Ç—å—Ä–æ–ª—å @—Ä–æ–ª—å`\n"
                "–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—É—é —Ä–æ–ª—å\n"
                "*–ü—Ä–∏–º–µ—Ä: !–¥–æ–±–∞–≤–∏—Ç—å—Ä–æ–ª—å @–û—Ñ–∏—Ü–µ—Ä*\n\n"
                
                "`!—É–¥–∞–ª–∏—Ç—å—Ä–æ–ª—å @—Ä–æ–ª—å`\n"
                "–£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å –∏–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö\n"
                "*–ü—Ä–∏–º–µ—Ä: !—É–¥–∞–ª–∏—Ç—å—Ä–æ–ª—å @–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä*\n\n"
                
                "`!—Ä–∞—Å—Å—ã–ª–∫–∞ —Ç–µ–∫—Å—Ç`\n"
                "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ\n"
                "*–ü—Ä–∏–º–µ—Ä: !—Ä–∞—Å—Å—ã–ª–∫–∞ –¢–µ—Å—Ç —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞*"
            ),
            inline=False
        )
    
    # –ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    embed.add_field(
    name="üí° **–ü–û–õ–ï–ó–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø**",
    value=(
        "‚Ä¢ –í—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ **–º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏** (MSK, UTC+3)\n"
        "‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: `!–≤—Ä–µ–º—è`\n"
        "‚Ä¢ –í—Å–µ —Å–æ–±—ã—Ç–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 3 –¥–Ω—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è\n"
        "‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –æ–±—ä—è–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –∑–∞ 15 –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞\n"
        "‚Ä¢ –ú–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–ø–Ω,—Å—Ä,–ø—Ç)\n"
        "‚Ä¢ –ö –∫–æ–º–∞–Ω–¥–∞–º –º–æ–∂–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ñ–∞–π–ª—ã\n"
        "‚Ä¢ –§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏: 24-—á–∞—Å–æ–≤–æ–π (14:30, 20:00 –∏ —Ç.–¥.)\n"
        "‚Ä¢ –û–±—ä—è–≤–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –æ–±—ä—è–≤–ª–µ–Ω–∏–π"
    ),
    inline=False
)
    
    # –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if ctx.author.guild_permissions.administrator:
        access_status = "üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞"
    else:
        allowed_roles = event_manager.config.get('allowed_roles', [])
        user_roles = [role for role in ctx.author.roles if role.id in allowed_roles]
        if user_roles:
            role_names = ", ".join([role.name for role in user_roles])
            access_status = f"‚úÖ –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ —Ä–æ–ª–∏: {role_names}"
        else:
            access_status = "‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–∞–Ω–¥)"
    
    embed.set_footer(text=f"–í–∞—à —Å—Ç–∞—Ç—É—Å: {access_status}")
    
    await ctx.send(embed=embed)

@bot.command()
async def –≤—Ä–µ–º—è(ctx):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è –±–æ—Ç–∞"""
    now = get_now()
    
    embed = discord.Embed(
        title="üïí **–ú–û–°–ö–û–í–°–ö–û–ï –í–†–ï–ú–Ø –ë–û–¢–ê**",
        color=discord.Color.blue(),
        timestamp=now
    )
    
    embed.add_field(
        name="üìç –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è",
        value=now.strftime("%d.%m.%Y %H:%M:%S"),
        inline=True
    )
    
    embed.add_field(
        name="üåê –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å",
        value="Europe/Moscow (UTC+3)",
        inline=True
    )
    
    embed.add_field(
        name="‚è∞ Discord Timestamp",
        value=f"`<t:{int(now.timestamp())}:F>`\n<t:{int(now.timestamp())}:F>",
        inline=False
    )
    
    embed.add_field(
        name="üí° –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π",
        value="–í—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ —ç—Ç–æ–º—É –≤—Ä–µ–º–µ–Ω–∏",
        inline=False
    )
    
    await ctx.send(embed=embed)

# ===========================================
# –ö–û–ú–ê–ù–î–´ –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –†–û–õ–Ø–ú–ò
# ===========================================

@bot.command()
@commands.has_permissions(administrator=True)
async def –¥–æ–±–∞–≤–∏—Ç—å—Ä–æ–ª—å(ctx, —Ä–æ–ª—å: discord.Role):
    """–î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è–º–∏"""
    allowed_roles = event_manager.config.get('allowed_roles', [])
    
    if —Ä–æ–ª—å.id not in allowed_roles:
        allowed_roles.append(—Ä–æ–ª—å.id)
        event_manager.config['allowed_roles'] = allowed_roles
        event_manager.save_config()
        
        embed = discord.Embed(
            title="‚úÖ –†–æ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∞",
            description=f"–†–æ–ª—å {—Ä–æ–ª—å.mention} —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è–º–∏",
            color=discord.Color.green()
        )
        await ctx.send(embed=embed)
    else:
        await ctx.send(f"‚ùå –†–æ–ª—å {—Ä–æ–ª—å.mention} —É–∂–µ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö")

@bot.command()
@commands.has_permissions(administrator=True)
async def —É–¥–∞–ª–∏—Ç—å—Ä–æ–ª—å(ctx, —Ä–æ–ª—å: discord.Role):
    """–£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å –∏–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö"""
    allowed_roles = event_manager.config.get('allowed_roles', [])
    
    if —Ä–æ–ª—å.id in allowed_roles:
        allowed_roles.remove(—Ä–æ–ª—å.id)
        event_manager.config['allowed_roles'] = allowed_roles
        event_manager.save_config()
        
        embed = discord.Embed(
            title="‚úÖ –†–æ–ª—å —É–¥–∞–ª–µ–Ω–∞",
            description=f"–†–æ–ª—å {—Ä–æ–ª—å.mention} –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è–º–∏",
            color=discord.Color.green()
        )
        await ctx.send(embed=embed)
    else:
        await ctx.send(f"‚ùå –†–æ–ª—å {—Ä–æ–ª—å.mention} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö")

@bot.command()
async def —Ä–æ–ª–∏(ctx):
    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    allowed_roles = event_manager.config.get('allowed_roles', [])
    
    if not allowed_roles:
        embed = discord.Embed(
            title="üìã –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏",
            description="‚ùå –ù–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π. –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è–º–∏.",
            color=discord.Color.red()
        )
    else:
        roles_list = []
        roles_to_remove = []
        
        for role_id in allowed_roles:
            role = ctx.guild.get_role(role_id)
            if role:
                roles_list.append(f"‚Ä¢ {role.mention}")
            else:
                # –ï—Å–ª–∏ —Ä–æ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                roles_to_remove.append(role_id)
        
        # –£–¥–∞–ª—è–µ–º –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ–ª–∏
        if roles_to_remove:
            for role_id in roles_to_remove:
                allowed_roles.remove(role_id)
            event_manager.config['allowed_roles'] = allowed_roles
            event_manager.save_config()
        
        if roles_list:
            embed = discord.Embed(
                title="üìã –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏",
                description="\n".join(roles_list),
                color=discord.Color.blue()
            )
            embed.set_footer(text=f"–í—Å–µ–≥–æ —Ä–æ–ª–µ–π: {len(roles_list)}")
        else:
            embed = discord.Embed(
                title="üìã –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏",
                description="‚ùå –í—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ä–æ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ",
                color=discord.Color.red()
            )
    
    await ctx.send(embed=embed)

# ===========================================
# –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ö–û–ú–ê–ù–î–ê !–†–ï–ì–£–õ–Ø–†–ù–û–ï (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π)
# ===========================================

@bot.command()
async def —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ(ctx, –¥–Ω–∏: str, —á–∞—Å: int, –º–∏–Ω—É—Ç–∞: int, *, —Ç–µ–∫—Å—Ç: str):
    """
    –°–æ–∑–¥–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ) —Å–æ–±—ã—Ç–∏–µ
    –§–æ—Ä–º–∞—Ç: !—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ [–¥–Ω–∏] –ß–ß –ú–ú —Ç–µ–∫—Å—Ç (–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)
    —Ç–µ–∫—Å—Ç (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞)
    —Ç–µ–∫—Å—Ç (–≤—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞)
    –î–Ω–∏: –ø–Ω, –≤—Ç, —Å—Ä, —á—Ç, –ø—Ç, —Å–±, –≤—Å (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
    –ü—Ä–∏–º–µ—Ä: !—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –ø–Ω,—Å—Ä,–ø—Ç 19 00 –ò–≥—Ä–æ–≤–æ–π –≤–µ—á–µ—Ä
    """
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π
    if not event_manager.config.get('announcement_channel_id'):
        await ctx.send("‚ùå –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∫–æ–º–∞–Ω–¥–æ–π `!–∫–∞–Ω–∞–ª–æ–±—ä—è–≤–ª–µ–Ω–∏–π`")
        return
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
    days_map = {
        '–ø–Ω': 0, '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫': 0,
        '–≤—Ç': 1, '–≤—Ç–æ—Ä–Ω–∏–∫': 1,
        '—Å—Ä': 2, '—Å—Ä–µ–¥–∞': 2,
        '—á—Ç': 3, '—á–µ—Ç–≤–µ—Ä–≥': 3,
        '–ø—Ç': 4, '–ø—è—Ç–Ω–∏—Ü–∞': 4,
        '—Å–±': 5, '—Å—É–±–±–æ—Ç–∞': 5,
        '–≤—Å': 6, '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ': 6
    }
    
    # –†–∞–∑–¥–µ–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –¥–Ω–µ–π –ø–æ –∑–∞–ø—è—Ç—ã–º
    day_strings = [day.strip().lower() for day in –¥–Ω–∏.split(',')]
    
    days_of_week = []
    invalid_days = []
    
    for day_str in day_strings:
        if day_str in days_map:
            days_of_week.append(days_map[day_str])
        else:
            invalid_days.append(day_str)
    
    if invalid_days:
        valid_days = ", ".join(days_map.keys())
        await ctx.send(f"‚ùå –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏: {', '.join(invalid_days)}\n"
                      f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: {valid_days}")
        return
    
    if not days_of_week:
        await ctx.send("‚ùå –ù–µ —É–∫–∞–∑–∞–Ω—ã –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏!")
        return
    
    # –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
    days_of_week = sorted(set(days_of_week))
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è
    if not (0 <= —á–∞—Å <= 23):
        await ctx.send("‚ùå –ß–∞—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 23")
        return
    if not (0 <= –º–∏–Ω—É—Ç–∞ <= 59):
        await ctx.send("‚ùå –ú–∏–Ω—É—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 59")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–ª–æ–∂–µ–Ω–∏—è
    image_url = None
    attachments = []
    
    if ctx.message.attachments:
        for attachment in ctx.message.attachments:
            if attachment.content_type and 'image' in attachment.content_type:
                if not image_url:
                    image_url = attachment.url
            attachments.append(attachment.url)
    
    # –†–∞–∑–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç
    lines = —Ç–µ–∫—Å—Ç.split('\n')
    event_name = lines[0].strip()
    custom_message = '\n'.join(lines[1:]).strip() if len(lines) > 1 else event_name
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
    event_id = event_manager.add_recurring_event(
        event_name=event_name,
        days_of_week=days_of_week,
        hour=—á–∞—Å,
        minute=–º–∏–Ω—É—Ç–∞,
        author_id=ctx.author.id,
        custom_message=custom_message,
        image_url=image_url,
        attachments=attachments
    )
    
    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ –ø–æ-—Ä—É—Å—Å–∫–∏
    days_russian = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ']
    selected_days = [days_russian[day] for day in days_of_week]
    
    # –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
    embed = discord.Embed(
        title=f"üìÖ **{event_name}** (–†–µ–≥—É–ª—è—Ä–Ω–æ–µ)",
        description=custom_message,
        color=discord.Color.purple()
    )
    
    embed.add_field(
        name="‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ",
        value=f"**–î–Ω–∏:** {', '.join(selected_days)}\n**–í—Ä–µ–º—è:** {—á–∞—Å:02d}:{–º–∏–Ω—É—Ç–∞:02d} (–ú–°–ö)",
        inline=False
    )
    
    embed.add_field(
        name="üì¢ –û–±—ä—è–≤–ª–µ–Ω–∏–µ",
        value="–ë—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –∑–∞ 15 –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞",
        inline=False
    )
    
    if image_url:
        embed.set_thumbnail(url=image_url)
        embed.add_field(name="üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", value="–ë—É–¥–µ—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ –∫ –∫–∞–∂–¥–æ–º—É –æ–±—ä—è–≤–ª–µ–Ω–∏—é", inline=True)
    
    if attachments:
        embed.set_footer(text=f"‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ #{event_id} —Å–æ–∑–¥–∞–Ω–æ! üìé {len(attachments)} –≤–ª–æ–∂–µ–Ω–∏–π")
    else:
        embed.set_footer(text=f"‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ #{event_id} —Å–æ–∑–¥–∞–Ω–æ!")
    
    await ctx.send("**–°–æ–∑–¥–∞–Ω–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ:**", embed=embed)

# ===========================================
# –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ö–û–ú–ê–ù–î–ê !–†–ï–ì–£–õ–Ø–†–ù–´–ï
# ===========================================

@bot.command()
async def —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ(ctx):
    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    if not event_manager.recurring_events:
        await ctx.send("üì≠ –ù–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.")
        return
    
    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏ –ø–æ-—Ä—É—Å—Å–∫–∏
    days_russian = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å']
    days_full = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ']
    
    embed = discord.Embed(
        title="üìÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è",
        color=discord.Color.purple()
    )
    
    for event in event_manager.recurring_events:
        # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏
        day_numbers = event['days_of_week']
        day_names = [days_full[day_num] for day_num in day_numbers]
        short_day_names = [days_russian[day_num] for day_num in day_numbers]
        
        event_info = (
            f"**ID:** `{event['id']}`\n"
            f"**–ù–∞–∑–≤–∞–Ω–∏–µ:** {event['name']}\n"
            f"**–î–Ω–∏:** {', '.join(day_names)}\n"
            f"**–ö—Ä–∞—Ç–∫–æ:** {', '.join(short_day_names)}\n"
            f"**–í—Ä–µ–º—è:** {event['hour']:02d}:{event['minute']:02d} (–ú–°–ö)\n"
        )
        
        if event.get('last_scheduled'):
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
            last_scheduled_text = []
            for day_num, date_str in event['last_scheduled'].items():
                day_name = days_russian[int(day_num)]
                try:
                    last_date = datetime.strptime(date_str, "%Y-%m-%d")
                    last_scheduled_text.append(f"{day_name}: <t:{int(last_date.timestamp())}:R>")
                except:  # noqa: E722
                    continue
            
            if last_scheduled_text:
                event_info += "**–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑:**\n" + "\n".join(last_scheduled_text) + "\n"
        
        # –û–±—Ä–µ–∑–∞–µ–º –¥–ª–∏–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
        description = event['custom_message']
        if len(description) > 100:
            description = description[:97] + "..."
        
        event_info += f"**–û–ø–∏—Å–∞–Ω–∏–µ:** {description}"
        
        embed.add_field(
            name=f"üîÑ #{event['id']}",
            value=event_info,
            inline=False
        )
    
    embed.add_field(
        name="üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ",
        value=f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `!—É–¥–∞–ª–∏—Ç—å—Ä–µ–≥ [ID]` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è\n–ü—Ä–∏–º–µ—Ä: `!—É–¥–∞–ª–∏—Ç—å—Ä–µ–≥ {event_manager.recurring_events[0]['id']}`",
        inline=False
    )
    
    await ctx.send(embed=embed)

@bot.command()
async def —É–¥–∞–ª–∏—Ç—å—Ä–µ–≥(ctx, event_id: int):
    """–£–¥–∞–ª–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –ø–æ ID"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    event_exists = any(e['id'] == event_id for e in event_manager.recurring_events)
    
    if event_exists:
        event_manager.remove_event(event_id, is_recurring=True)
        await ctx.send(f"‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ #{event_id} —É–¥–∞–ª–µ–Ω–æ.")
    else:
        await ctx.send(f"‚ùå –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ #{event_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")

# ===========================================
# –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ö–û–ú–ê–ù–î–ê !–°–û–ë–´–¢–ò–Ø
# ===========================================

@bot.command()
async def —Å–æ–±—ã—Ç–∏—è(ctx):
    """–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è (–æ–±—ã—á–Ω—ã–µ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ)"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    active_events = [e for e in event_manager.events if not e['finished']]
    finished_events = [e for e in event_manager.events if e['finished']]
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    if active_events:
        embed = discord.Embed(
            title="üìÖ –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è",
            color=discord.Color.green()
        )
        
        for event in active_events[:5]:
            event_time = from_iso_with_timezone(event['event_time'])
            announcement_time = from_iso_with_timezone(event['announcement_time'])
            now = get_now()
            
            if event['announced']:
                status = "‚úÖ –û–±—ä—è–≤–ª–µ–Ω–æ"
            else:
                time_left = announcement_time - now
                if time_left.total_seconds() > 0:
                    status = f"‚è≥ –ß–µ—Ä–µ–∑ {int(time_left.total_seconds() / 60)} –º–∏–Ω"
                else:
                    status = "üïí –°–∫–æ—Ä–æ"
            
            event_info = (
                f"**ID:** `{event['id']}`\n"
                f"**–ù–∞–∑–≤–∞–Ω–∏–µ:** {event['name']}\n"
                f"**–°—Ç–∞—Ç—É—Å:** {status}\n"
                f"**–ù–∞—á–∞–ª–æ:** <t:{int(event_time.timestamp())}:F>\n"
                f"**–û–±—ä—è–≤–ª–µ–Ω–∏–µ:** <t:{int(announcement_time.timestamp())}:R>"
            )
            
            embed.add_field(
                name=f"üìå #{event['id']}",
                value=event_info,
                inline=False
            )
        
        await ctx.send(embed=embed)
    else:
        await ctx.send("üì≠ –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    if finished_events:
        recent_finished = []
        now = get_now()
        for event in finished_events[-3:]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
            event_time = from_iso_with_timezone(event['event_time'])
            days_passed = (now - event_time).days
            
            if days_passed <= 3:
                recent_finished.append(event)
        
        if recent_finished:
            embed = discord.Embed(
                title="üìã –ù–µ–¥–∞–≤–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è",
                color=discord.Color.dark_grey()
            )
            
            for event in recent_finished:
                event_time = from_iso_with_timezone(event['event_time'])
                
                event_info = (
                    f"**ID:** `{event['id']}`\n"
                    f"**–ù–∞–∑–≤–∞–Ω–∏–µ:** {event['name']}\n"
                    f"**–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** <t:{int(event_time.timestamp())}:R>"
                )
                
                embed.add_field(
                    name=f"‚úÖ #{event['id']}",
                    value=event_info,
                    inline=False
                )
            
            embed.set_footer(text="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—Å—è —á–µ—Ä–µ–∑ 3 –¥–Ω—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è")
            await ctx.send(embed=embed)
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    if event_manager.recurring_events:
        days_russian = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å']
        
        embed = discord.Embed(
            title="üîÑ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è",
            color=discord.Color.purple()
        )
        
        for event in event_manager.recurring_events[:3]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ 3
            day_numbers = event['days_of_week']
            short_day_names = [days_russian[day_num] for day_num in day_numbers]
            
            event_info = (
                f"**ID:** `–†{event['id']}`\n"
                f"**–ù–∞–∑–≤–∞–Ω–∏–µ:** {event['name']}\n"
                f"**–ö–æ–≥–¥–∞:** {', '.join(short_day_names)} –≤ {event['hour']:02d}:{event['minute']:02d} (–ú–°–ö)\n"
            )
            
            # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            if event.get('last_scheduled'):
                sent_count = len(event['last_scheduled'])
                event_info += f"**–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–∑:** {sent_count}"
            
            embed.add_field(
                name=f"üìÖ #{event['id']}",
                value=event_info,
                inline=False
            )
        
        if len(event_manager.recurring_events) > 3:
            embed.set_footer(text=f"–ò –µ—â—ë {len(event_manager.recurring_events) - 3} —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ !—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞")
        
        await ctx.send(embed=embed)

# ===========================================
# –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ö–û–ú–ê–ù–î–ê !–£–î–ê–õ–ò–¢–¨
# ===========================================

@bot.command()
async def —É–¥–∞–ª–∏—Ç—å(ctx, event_id: int):
    """–£–¥–∞–ª–∏—Ç—å –æ–±—ã—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –ø–æ ID"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ã—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    event_exists = any(e['id'] == event_id for e in event_manager.events)
    
    if event_exists:
        event_manager.remove_event(event_id, is_recurring=False)
        await ctx.send(f"‚úÖ –°–æ–±—ã—Ç–∏–µ #{event_id} —É–¥–∞–ª–µ–Ω–æ.")
    else:
        await ctx.send(f"‚ùå –°–æ–±—ã—Ç–∏–µ #{event_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")

# ===========================================
# –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ö–û–ú–ê–ù–î–ê !–û–ß–ò–°–¢–ö–ê
# ===========================================

@bot.command()
async def –æ—á–∏—Å—Ç–∫–∞(ctx):
    """–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π (–±–æ–ª–µ–µ 3 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    now = get_now()
    events_to_remove = []
    
    for event in event_manager.events:
        if event['finished']:
            event_time = from_iso_with_timezone(event['event_time'])
            days_passed = (now - event_time).days
            
            if days_passed > 3:
                events_to_remove.append((event['id'], False))
    
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è
    for event_id, is_recurring in events_to_remove:
        event_manager.remove_event(event_id, is_recurring)
    
    if events_to_remove:
        await ctx.send(f"‚úÖ –£–¥–∞–ª–µ–Ω–æ {len(events_to_remove)} —Å—Ç–∞—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π (–±–æ–ª–µ–µ 3 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)")
    else:
        await ctx.send("üì≠ –ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ (–≤—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –º–ª–∞–¥—à–µ 3 –¥–Ω–µ–π)")

# ===========================================
# –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ö–û–ú–ê–ù–î–ê !–ö–ê–ù–ê–õ–´
# ===========================================

@bot.command()
async def –∫–∞–Ω–∞–ª—ã(ctx):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    embed = discord.Embed(
        title="üìä –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã",
        color=discord.Color.blue()
    )
    
    announcement_channel_id = event_manager.config.get('announcement_channel_id')
    if announcement_channel_id:
        channel = bot.get_channel(announcement_channel_id)
        embed.add_field(name="üì¢ –ö–∞–Ω–∞–ª –æ–±—ä—è–≤–ª–µ–Ω–∏–π", value=f"#{channel.name}" if channel else "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω", inline=True)
    else:
        embed.add_field(name="üì¢ –ö–∞–Ω–∞–ª –æ–±—ä—è–≤–ª–µ–Ω–∏–π", value="‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω", inline=True)
    
    admin_channel_id = event_manager.config.get('admin_channel_id')
    if admin_channel_id:
        channel = bot.get_channel(admin_channel_id)
        embed.add_field(name="üëë –ê–¥–º–∏–Ω-–∫–∞–Ω–∞–ª", value=f"#{channel.name}" if channel else "‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω", inline=True)
    else:
        embed.add_field(name="üëë –ê–¥–º–∏–Ω-–∫–∞–Ω–∞–ª", value="‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω", inline=True)
    
    active = len([e for e in event_manager.events if not e['finished']])
    recurring = len(event_manager.recurring_events)
    allowed_roles = len(event_manager.config.get('allowed_roles', []))
    
    embed.add_field(name="üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", 
                   value=f"–ê–∫—Ç–∏–≤–Ω—ã—Ö: {active}\n–†–µ–≥—É–ª—è—Ä–Ω—ã—Ö: {recurring}\n–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π: {allowed_roles}", 
                   inline=True)
    
    await ctx.send(embed=embed)

# ===========================================
# –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ù–ê–°–¢–†–û–ô–ö–ò (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
# ===========================================

@bot.command()
@commands.has_permissions(administrator=True)
async def –∫–∞–Ω–∞–ª–æ–±—ä—è–≤–ª–µ–Ω–∏–π(ctx):
    """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π"""
    event_manager.config['announcement_channel_id'] = ctx.channel.id
    event_manager.save_config()
    await ctx.send(f"‚úÖ –≠—Ç–æ—Ç –∫–∞–Ω–∞–ª —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π: #{ctx.channel.name}")

@bot.command()
@commands.has_permissions(administrator=True)
async def –∫–∞–Ω–∞–ª–∞–¥–º–∏–Ω(ctx):
    """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–∞–Ω–∞–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"""
    event_manager.config['admin_channel_id'] = ctx.channel.id
    event_manager.save_config()
    
    embed = discord.Embed(
        title="‚úÖ –ê–¥–º–∏–Ω-–∫–∞–Ω–∞–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω",
        description=f"–ö–∞–Ω–∞–ª #{ctx.channel.name} —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è–º–∏",
        color=discord.Color.green()
    )
    
    embed.add_field(
        name="üìù –ö–æ–º–∞–Ω–¥—ã:",
        value=(
            "`!–Ω–æ–≤–æ–µ –î–î –ú–ú –ì–ì–ì–ì –ß–ß –ú–ú —Ç–µ–∫—Å—Ç` - —Ä–∞–∑–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ\n"
            "`!—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –¥–Ω–∏ –ß–ß –ú–ú —Ç–µ–∫—Å—Ç` - —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ\n"
            "`!—Å–æ–±—ã—Ç–∏—è` - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è\n"
            "`!—Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ` - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ\n"
            "`!—É–¥–∞–ª–∏—Ç—å ID` - —É–¥–∞–ª–∏—Ç—å —Ä–∞–∑–æ–≤–æ–µ\n"
            "`!—É–¥–∞–ª–∏—Ç—å—Ä–µ–≥ ID` - —É–¥–∞–ª–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ\n"
            "`!–æ—á–∏—Å—Ç–∫–∞` - —Ä—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö\n"
            "`!—Ä–æ–ª–∏` - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏\n"
            "`!–ø–æ–º–æ—â—å` - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã\n"
            "`!–∫–∞–Ω–∞–ª—ã` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
        ),
        inline=False
    )
    
    embed.add_field(
        name="üëë –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:",
        value=(
            "`!–¥–æ–±–∞–≤–∏—Ç—å—Ä–æ–ª—å @—Ä–æ–ª—å` - –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—É—é —Ä–æ–ª—å\n"
            "`!—É–¥–∞–ª–∏—Ç—å—Ä–æ–ª—å @—Ä–æ–ª—å` - —É–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å –∏–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö\n"
            "`!–∫–∞–Ω–∞–ª–æ–±—ä—è–≤–ª–µ–Ω–∏–π` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π\n"
            "`!–∫–∞–Ω–∞–ª–∞–¥–º–∏–Ω` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–Ω–∞–ª –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\n"
            "`!—Ä–∞—Å—Å—ã–ª–∫–∞ —Ç–µ–∫—Å—Ç` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ"
        ),
        inline=False
    )
    
    await ctx.send(embed=embed)

# ===========================================
# –û–°–¢–ê–õ–¨–ù–´–ï –ö–û–ú–ê–ù–î–´ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ —Å –Ω–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π)
# ===========================================

@bot.command()
async def –Ω–æ–≤–æ–µ(ctx, –¥–µ–Ω—å: int, –º–µ—Å—è—Ü: int, –≥–æ–¥: int, —á–∞—Å: int, –º–∏–Ω—É—Ç–∞: int, *, —Ç–µ–∫—Å—Ç: str):
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Ä–∞–∑–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π
    if not event_manager.config.get('announcement_channel_id'):
        await ctx.send("‚ùå –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∫–æ–º–∞–Ω–¥–æ–π `!–∫–∞–Ω–∞–ª–æ–±—ä—è–≤–ª–µ–Ω–∏–π`")
        return
    
    try:
        # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è –í –ú–û–°–ö–û–í–°–ö–û–ú –í–†–ï–ú–ï–ù–ò
        event_time = parse_datetime(–≥–æ–¥, –º–µ—Å—è—Ü, –¥–µ–Ω—å, —á–∞—Å, –º–∏–Ω—É—Ç–∞)
        
        # –í—Ä–µ–º—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–∑–∞ 15 –º–∏–Ω—É—Ç –¥–æ —Å–æ–±—ã—Ç–∏—è)
        announcement_time = event_time - timedelta(minutes=15)
        
        now = get_now()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Ä–µ–º—è –≤ –±—É–¥—É—â–µ–º
        if event_time <= now:
            await ctx.send("‚ùå –í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º!")
            return
        
        if announcement_time <= now:
            await ctx.send("‚ùå –í—Ä–µ–º—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è —É–∂–µ –ø—Ä–æ—à–ª–æ! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è.")
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–ª–æ–∂–µ–Ω–∏—è
        image_url = None
        attachments = []
        
        if ctx.message.attachments:
            for attachment in ctx.message.attachments:
                if attachment.content_type and 'image' in attachment.content_type:
                    if not image_url:
                        image_url = attachment.url
                attachments.append(attachment.url)
        
        # –†–∞–∑–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç
        lines = —Ç–µ–∫—Å—Ç.split('\n')
        event_name = lines[0].strip()
        custom_message = '\n'.join(lines[1:]).strip() if len(lines) > 1 else event_name
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ
        event_id = event_manager.add_event(
            event_name=event_name,
            event_time=event_time,
            announcement_time=announcement_time,
            author_id=ctx.author.id,
            custom_message=custom_message,
            image_url=image_url,
            attachments=attachments
        )
        
        # –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
        embed = discord.Embed(
            title=f"üìÖ **{event_name}**",
            description=custom_message,
            color=discord.Color.blue(),
            timestamp=event_time
        )
        
        embed.add_field(
            name="‚è∞ –ù–∞—á–∞–ª–æ",
            value=f"<t:{int(event_time.timestamp())}:F>",
            inline=False
        )
        
        embed.add_field(
            name="üì¢ –û–±—ä—è–≤–ª–µ–Ω–∏–µ",
            value=f"–ë—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ <t:{int(announcement_time.timestamp())}:R>",
            inline=False
        )
        
        if image_url:
            embed.set_thumbnail(url=image_url)
            embed.add_field(name="üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", value="–ë—É–¥–µ—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ –∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—é", inline=True)
        
        if attachments:
            embed.set_footer(text=f"‚úÖ –°–æ–±—ã—Ç–∏–µ #{event_id} —Å–æ–∑–¥–∞–Ω–æ! üìé {len(attachments)} –≤–ª–æ–∂–µ–Ω–∏–π")
        else:
            embed.set_footer(text=f"‚úÖ –°–æ–±—ã—Ç–∏–µ #{event_id} —Å–æ–∑–¥–∞–Ω–æ!")
        
        await ctx.send("**–°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ:**", embed=embed)
        
    except ValueError as e:
        await ctx.send(f"‚ùå –û—à–∏–±–∫–∞ –≤ –¥–∞—Ç–µ –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–∏: {e}")

@bot.command()
async def –∏–Ω—Ñ–æ(ctx, event_id: int):
    """–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–±—ã—Ç–∏–∏"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    # –ò—â–µ–º –æ–±—ã—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
    event = next((e for e in event_manager.events if e['id'] == event_id), None)
    
    if not event:
        await ctx.send(f"‚ùå –°–æ–±—ã—Ç–∏–µ #{event_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")
        return
    
    event_time = from_iso_with_timezone(event['event_time'])
    announcement_time = from_iso_with_timezone(event['announcement_time'])
    now = get_now()
    
    embed = discord.Embed(
        title=f"üìã **{event['name']}**",
        description=event['custom_message'],
        color=discord.Color.blue(),
        timestamp=event_time
    )
    
    status = "‚úÖ –û–±—ä—è–≤–ª–µ–Ω–æ" if event['announced'] else "‚è≥ –û–∂–∏–¥–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è"
    status = "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ" if event['finished'] else status
    
    embed.add_field(name="üÜî ID", value=event['id'], inline=True)
    embed.add_field(name="üìä –°—Ç–∞—Ç—É—Å", value=status, inline=True)
    
    if event['announced'] and not event['finished']:
        time_to_event = event_time - now
        if time_to_event.total_seconds() > 0:
            embed.add_field(
                name="‚è≥ –î–æ –Ω–∞—á–∞–ª–∞",
                value=f"{int(time_to_event.total_seconds() / 60)} –º–∏–Ω—É—Ç",
                inline=True
            )
        else:
            embed.add_field(name="‚è≥ –î–æ –Ω–∞—á–∞–ª–∞", value="–°–∫–æ—Ä–æ –Ω–∞—á–Ω–µ—Ç—Å—è", inline=True)
    
    embed.add_field(name="‚è∞ –ù–∞—á–∞–ª–æ", value=f"<t:{int(event_time.timestamp())}:F>", inline=False)
    embed.add_field(name="üì¢ –û–±—ä—è–≤–ª–µ–Ω–∏–µ", value=f"<t:{int(announcement_time.timestamp())}:R>", inline=True)
    
    author = ctx.guild.get_member(event['author'])
    if author:
        embed.add_field(name="üë§ –°–æ–∑–¥–∞–ª", value=author.mention, inline=True)
    
    if event.get('image_url'):
        embed.set_image(url=event['image_url'])
    
    if event.get('attachments'):
        attachments_text = "\n".join([f"‚Ä¢ {url}" for url in event['attachments'][:3]])
        if len(event['attachments']) > 3:
            attachments_text += f"\n... –∏ –µ—â—ë {len(event['attachments']) - 3}"
        embed.add_field(name="üìé –í–ª–æ–∂–µ–Ω–∏—è", value=attachments_text, inline=False)
    
    await ctx.send(embed=embed)

@bot.command()
async def —Ç–µ—Å—Ç(ctx):
    """–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–æ—Ç–∞"""
    if not await check_permissions(ctx):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ!")
        return
    
    embed = discord.Embed(
        title="ü§ñ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!",
        description="–°–∏—Å—Ç–µ–º–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∞–∫—Ç–∏–≤–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.",
        color=discord.Color.green()
    )
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    active_events = len([e for e in event_manager.events if not e['finished']])
    total_events = len(event_manager.events)
    recurring_events = len(event_manager.recurring_events)
    
    embed.add_field(name="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", 
                   value=f"–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π: {active_events}\n–í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π: {total_events}\n–†–µ–≥—É–ª—è—Ä–Ω—ã—Ö: {recurring_events}", 
                   inline=True)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
    announcement_channel = bot.get_channel(event_manager.config.get('announcement_channel_id'))
    admin_channel = bot.get_channel(event_manager.config.get('admin_channel_id'))
    
    channels_status = []
    if announcement_channel:
        channels_status.append(f"‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏—è: #{announcement_channel.name}")
    else:
        channels_status.append("‚ùå –û–±—ä—è–≤–ª–µ–Ω–∏—è: –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
    
    if admin_channel:
        channels_status.append(f"‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: #{admin_channel.name}")
    else:
        channels_status.append("‚ùå –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
    
    embed.add_field(name="üì¢ –ö–∞–Ω–∞–ª—ã", value="\n".join(channels_status), inline=True)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π
    allowed_roles = event_manager.config.get('allowed_roles', [])
    roles_count = len(allowed_roles)
    if roles_count > 0:
        embed.add_field(name="üë• –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏", value=f"{roles_count} —Ä–æ–ª—å(–µ–π) –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø", inline=True)
    else:
        embed.add_field(name="üë• –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏", value="–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã", inline=True)
    
    # –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
    now = get_now()
    uptime = now - bot.start_time if hasattr(bot, 'start_time') else timedelta(seconds=0)
    embed.set_footer(text=f"–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: {int(uptime.total_seconds() / 3600)} —á {int((uptime.total_seconds() % 3600) / 60)} –º–∏–Ω")
    
    await ctx.send(embed=embed)

@bot.command()
@commands.has_permissions(administrator=True)
async def —Ä–∞—Å—Å—ã–ª–∫–∞(ctx, *, —Å–æ–æ–±—â–µ–Ω–∏–µ: str):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª"""
    channel_id = event_manager.config.get('announcement_channel_id')
    if not channel_id:
        await ctx.send("‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π!")
        return
    
    channel = bot.get_channel(channel_id)
    if not channel:
        await ctx.send("‚ùå –ö–∞–Ω–∞–ª –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        return
    
    try:
        embed = discord.Embed(
            title="üì¢ **–¢–ï–°–¢–û–í–û–ï –û–ë–™–Ø–í–õ–ï–ù–ò–ï**",
            description=—Å–æ–æ–±—â–µ–Ω–∏–µ,
            color=discord.Color.gold(),
            timestamp=get_now()
        )
        
        embed.add_field(
            name="‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
            value="–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞",
            inline=False
        )
        
        embed.set_footer(text=f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {ctx.author.display_name}")
        
        await channel.send(embed=embed)
        await ctx.send(f"‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ {channel.mention}")
        
    except Exception as e:
        await ctx.send(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e}")

@bot.event
async def on_command_error(ctx, error):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ–º–∞–Ω–¥"""
    if isinstance(error, commands.MissingPermissions):
        await ctx.send("‚ùå –£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã!")
    elif isinstance(error, commands.MissingRequiredArgument):
        await ctx.send(f"‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ: `{ctx.prefix}{ctx.command.name} {ctx.command.signature}`")
    elif isinstance(error, commands.BadArgument):
        await ctx.send("‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞.")
    else:
        print(f"–û—à–∏–±–∫–∞ –∫–æ–º–∞–Ω–¥—ã: {error}")
        await ctx.send("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã!")

# ===========================================
# –î–õ–Ø REPLIT (UPTIME ROBOT)
# ===========================================

app = Flask('')

@app.route('/')
def home():
    return "‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç! –í—Ä–µ–º—è: " + time.strftime("%Y-%m-%d %H:%M:%S")

def run():
    app.run(host='0.0.0.0', port=8080)

def keep_alive():
    t = Thread(target=run)
    t.start()

# –ó–∞–ø—É—Å–∫–∞–µ–º Flask —Å–µ—Ä–≤–µ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
keep_alive()

# ===========================================
# –ó–ê–ü–£–°–ö –ë–û–¢–ê
# ===========================================
bot.run(TOKEN)
